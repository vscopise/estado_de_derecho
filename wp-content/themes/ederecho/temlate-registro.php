<?php/* Template Name: Registro */get_header(); $user_name = filter_input( INPUT_POST, 'user_name');$user_mail = filter_input( INPUT_POST, 'user_mail', FILTER_VALIDATE_EMAIL);$user_key = wp_generate_password( 20, false );$expiry_time = date( 'Y-m-d', strtotime('+7 days') );$nonce = esc_attr(filter_input(INPUT_POST, 'new_user_nonce'));$usuarios_temporales = get_option( 'usuarios_temporales' );if ( $user_name != NULL || $user_mail != NULL ) {        $error = FALSE;    $mensaje = '';        if( !isset( $nonce ) || !wp_verify_nonce( $nonce, 'new_user' ) ) {            $error = TRUE;            $mensaje = 'Error.';    } else {        if ( $user_name == NULL || $user_mail == NULL ) {                $error = TRUE;                $mensaje = 'Por favor, completa correctamente los datos requeridos.';        } else {                if ( !$user_mail ) {                        $error = TRUE;                        $mensaje = 'E-mail incorrecto';                } elseif ( email_exists( $user_mail ) ) {                        $error = TRUE;                        $mensaje = 'Este e-mail ya est치 registrado';                } elseif ( $usuarios_temporales && is_int( array_search( $user_mail, array_column($usuarios_temporales, 'user_mail') ) ) ) {                        $error = TRUE;                        $mensaje = 'Este Email ya est치 registrado';                } elseif ( $usuarios_temporales && is_int( array_search( $user_name, array_column($usuarios_temporales, 'user_name') ) ) ) {                        $error = TRUE;                        $mensaje = 'Este Usuario ya est치 registrado';                } elseif ( username_exists( $user_name ) ) {                        $error = TRUE;                        $mensaje = 'Este Usuario ya est치 registrado';                } else {                        $new_user = array(                            'user_name' => $user_name,                            'user_mail' => $user_mail,                            'user_key' => $user_key,                            'expiry_time' => $expiry_time,                        );                        if ( ! $usuarios_temporales ) {                            $usuarios_temporales = array();                        }                        array_push( $usuarios_temporales, $new_user );                        update_option( 'usuarios_temporales', $usuarios_temporales );                        //enviar mail                        $logo_url = wp_get_attachment_image_src( get_theme_mod( 'custom_logo' ) , 'full' );                        $home_url = home_url('/');                        $terminos_y_condiciones = get_permalink( get_page_by_path( 'terminos-y-condiciones' ) -> ID );                        $parms = array(                            'logo_url' => $logo_url[0],                            'home_url' => $home_url,                            'user_name' => $user_name,                            'user_key' => $user_key,                            'user_mail' => $user_mail,                            'terminos_y_condiciones' => $terminos_y_condiciones                        );                        $mail_data = ed_compose_mail( 'new_user.php', $parms );                        $mail_data = get_mail_new_user( $logo_url[0], $home_url, $user_name, $user_key, $user_mail, $terminos_y_condiciones );                        $headers = array('Content-Type: text/html; charset=UTF-8');                        $subject = 'Bienvenido a Estado de Derecho';                        $result = wp_mail( $user_mail, $subject, $mail_data, $headers );                        $error = FALSE;                        $mensaje = 'Mensaje enviado correctamente, ahora revise su mail';                }        }    }} ?><div class="clear"></div></header> <!-- / END HOME SECTION  --><?php	zerif_after_header_trigger();	$zerif_change_to_full_width = get_theme_mod( 'zerif_change_to_full_width' );?><div id="content" class="site-content">	<div class="container">            <?php zerif_before_page_content_trigger(); ?>		            <div class="content-left-wrap col-md-9">		<?php zerif_top_page_content_trigger(); ?>		<div id="primary" class="content-area">			<main itemscope itemtype="http://schema.org/WebPageElement" itemprop="mainContentOfPage" id="main" class="site-main">                            <?php while ( have_posts() ) : the_post(); ?>                            <article id="post-<?php the_ID(); ?>" <?php post_class(); ?>>                                    <header class="entry-header"><?php zerif_page_header_trigger(); ?></header><!-- .entry-header -->                                    <div class="entry-content register-form">                                        <?php if ( $mensaje != '' ) : ?>                                            <?php if ( $error == TRUE ) : ?>                                            <div class="alert alert-danger"><?php echo $mensaje ?></div>                                            <?php else : ?>                                            <div class="alert alert-success"><?php echo $mensaje ?></div>                                            <?php endif; ?>                                        <?php endif; ?>                                                                                    <?php if ( $mensaje == '' && $error == FALSE ) : ?>                                                                                        <?php the_content() ?>                                                                                        <form action="<?php echo $_SERVER['REQUEST_URI'] ?>" method="post">                                                                                                <?php wp_nonce_field('new_user', 'new_user_nonce', true, true ); ?>                                                <div class="row">                                                    <div class="col-lg-12 col-sm-12">                                                        <label for="user_name">Usuario <strong>*</strong></label>                                                        <input type="text" name="user_name" value="">                                                    </div>                                                </div>                                                <div class="row">                                                    <div class="col-lg-12 col-sm-12 form_field_wrap">                                                        <label for="user_mail">Mail <strong>*</strong></label>                                                        <input type="text" name="user_mail" value="">                                                    </div>                                                </div>                                                <input type="submit" name="submit" value="Enviar !"/>                                            </form>                                        <?php endif; ?>                                    </div><!-- .entry-content -->                                    <?php edit_post_link( __( 'Edit', 'zerif-lite' ), '<footer class="entry-footer"><span class="edit-link">', '</span></footer>' ); ?>                            </article><!-- #post-## -->				                            <?php endwhile;?>			</main><!-- #main -->		</div><!-- #primary -->                <?php zerif_bottom_page_content_trigger(); ?>		            </div>                        <?php zerif_after_page_content_trigger(); zerif_sidebar_trigger(); ?>            	</div><!-- .container --><?php get_footer(); ?>