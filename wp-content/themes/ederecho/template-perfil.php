<?php/* Template Name: Perfil */global $current_user, $wp_roles;//$user_ID = $current_user->ID;//$email = get_the_author_meta( 'user_email', $current_user->ID );$user_name = get_the_author_meta( 'login', $current_user->ID );$current_user_mail = get_the_author_meta( 'email', $current_user->ID );$current_first_name = get_the_author_meta( 'first_name', $current_user->ID );$current_last_name = get_the_author_meta( 'last_name', $current_user->ID );$current_phone1 = get_the_author_meta( 'phone1', $current_user->ID );$current_phone2 = get_the_author_meta( 'phone2', $current_user->ID );$nonce = esc_attr(filter_input(INPUT_POST, 'user_perfil_nonce'));$user_mail = filter_input( INPUT_POST, 'user_mail', FILTER_VALIDATE_EMAIL);$first_name = esc_attr(filter_input(INPUT_POST, 'first_name'));$last_name = esc_attr(filter_input(INPUT_POST, 'last_name'));$phone1 = esc_attr(filter_input(INPUT_POST, 'phone1'));$phone2 = esc_attr(filter_input(INPUT_POST, 'phone2'));$user_pass1 = esc_attr(filter_input(INPUT_POST, 'user_pass1'));$user_pass2 = esc_attr(filter_input(INPUT_POST, 'user_pass2'));$user_id = esc_attr(filter_input(INPUT_POST, 'user_id'));if( $user_id != NULL && isset( $nonce ) && wp_verify_nonce( $nonce, 'perfil' ) ) {        $error = FALSE;    $mensaje = '';        if ( $user_pass1 != NULL || $user_pass2 != NULL ) {        if ( $user_pass1 != $user_pass2 ) {            $error = TRUE;            $mensaje = 'Las contraseñas no coinciden';        } else {            $user_id = $current_user->ID;            $username = get_userdata($user_id)->user_login;            wp_update_user( array(                'ID' => $user_id,                 'user_pass' => $user_pass1,            ));            wp_cache_delete($user_id, 'users');            wp_cache_delete($username, 'userlogins');            wp_logout();            wp_signon( array( 'user_login' => $username, 'user_password' => $user_pass1 ) );                        $mensaje = 'Contraseñas modificadas.';        }    }        if ( $error == FALSE ) {        if ( !$user_mail ) {            $error = TRUE;            $mensaje .= 'E-mail incorrecto';        } elseif ( email_exists( $user_mail ) && ( $user_mail != $current_user_mail ) ) {            $error = TRUE;            $mensaje = 'Este e-mail ya está registrado';        } else {            wp_update_user( array(                'ID' => $current_user->ID,                 'user_email' => $user_mail,                'first_name' => $first_name,                'last_name' => $last_name,            ));                        update_user_meta( $current_user->ID, 'phone1', $phone1 );            update_user_meta( $current_user->ID, 'phone2', $phone2 );                        $current_user_mail = $user_mail;            $current_first_name = $first_name;            $current_last_name = $last_name;                        $current_phone1 = $phone1;            $current_phone2 = $phone2;                        $mensaje = 'Datos actualizados correctamente.';        }    }     }get_header(); ?><div class="clear"></div></header> <!-- / END HOME SECTION  --><?php	zerif_after_header_trigger();	$zerif_change_to_full_width = get_theme_mod( 'zerif_change_to_full_width' );?><div id="content" class="site-content">	<div class="container">            <?php zerif_before_page_content_trigger(); ?>		            <div class="content-left-wrap col-md-9">		<?php zerif_top_page_content_trigger(); ?>		<div id="primary" class="content-area">			<main itemscope itemtype="http://schema.org/WebPageElement" itemprop="mainContentOfPage" id="main" class="site-main">                            <?php while ( have_posts() ) : the_post(); ?>                            <article id="post-<?php the_ID(); ?>" <?php post_class(); ?>>                                    <header class="entry-header"><?php zerif_page_header_trigger(); ?></header><!-- .entry-header -->                                    <div class="entry-content register-form">                                        <?php if ( $mensaje != '' ) : ?>                                            <?php if ( $error == TRUE ) : ?>                                            <div class="alert alert-danger"><?php echo $mensaje ?></div>                                            <?php else : ?>                                            <div class="alert alert-success"><?php echo $mensaje ?></div>                                            <?php endif; ?>                                        <?php endif; ?>                                                                                <form action="<?php echo $_SERVER['REQUEST_URI'] ?>" method="post">                                            <?php wp_nonce_field('perfil','user_perfil_nonce', true, true ); ?>                                            <input type="hidden" name="user_id" value="<?php echo $current_user->ID ?>" />                                            <div class="row">                                                <div class="col-lg-12 col-sm-12">                                                    <label for="username">Usuario <strong>*</strong></label>                                                    <input type="text" name="username" disabled="disabled" value="<?php echo $user_name ?>" />                                                </div>                                            </div>                                            <div class="row">                                                <div class="col-lg-12 col-sm-12">                                                    <label for="user_mail">Mail</label>                                                    <input type="text" name="user_mail" value="<?php echo $current_user_mail ?>" />                                                </div>                                            </div>                                            <div class="row">                                                <div class="col-lg-12 col-sm-12">                                                    <label for="first_name">Nombre</label>                                                    <input type="text" name="first_name" value="<?php echo $current_first_name ?>" />                                                </div>                                            </div>                                            <div class="row">                                                <div class="col-lg-12 col-sm-12">                                                    <label for="last_name">Apellido</label>                                                    <input type="text" name="last_name" value="<?php echo $current_last_name ?>" />                                                </div>                                            </div>                                            <div class="row">                                                <div class="col-lg-6 col-sm-6">                                                    <label for="last_name">Teléfono</label>                                                    <input type="text" name="phone1" value="<?php echo $current_phone1 ?>" />                                                </div>                                                <div class="col-lg-6 col-sm-6">                                                    <label for="last_name">Celular</label>                                                    <input type="text" name="phone2" value="<?php echo $current_phone2 ?>" />                                                </div>                                            </div>                                            <div class="row">                                                <div class="col-lg-12 col-sm-12">                                                    <label for="password1">Contraseña</label>                                                    <input type="password" name="user_pass1" value="" />                                                </div>                                            </div>                                            <div class="row">                                                <div class="col-lg-12 col-sm-12">                                                    <label for="password2">Confirmar Contraseña</label>                                                    <input type="password" name="user_pass2" value="" />                                                </div>                                            </div>                                                                                        <div class="row">                                                <div class="col-lg-12 col-sm-12 form_field_wrap">                                                    <input type="submit" name="submit" value="Actualizar perfil"/>                                                </div>                                            </div>                                        </form>                                    </div><!-- .entry-content -->                                    <?php edit_post_link( __( 'Edit', 'zerif-lite' ), '<footer class="entry-footer"><span class="edit-link">', '</span></footer>' ); ?>                            </article><!-- #post-## -->				                            <?php endwhile;?>			</main><!-- #main -->		</div><!-- #primary -->                <?php zerif_bottom_page_content_trigger(); ?>		            </div>                        <?php zerif_after_page_content_trigger(); zerif_sidebar_trigger(); ?>            	</div><!-- .container --><?php get_footer(); ?>